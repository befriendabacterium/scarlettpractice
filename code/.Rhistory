library(lattice)
#install.packages("tidyr")
library(tidyr)
# Load dataset ------------------------------------------------------------
getwd()
Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
Global_Mobility_Report$date<-as.Date(Global_Mobility_Report$date,format = "%d/%m/%y")
Global_Mobility_Report$parks_percent_change_from_baseline<-as.numeric(Global_Mobility_Report$parks_percent_change_from_baseline)
# Start -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
# Load packages ----------------------------------------------------------
#install.packages('plotrix')
library(plotrix)
#install.packages('tibble')
library(tibble)
#install.packages('ggplot2')
library(ggplot2)
#install.packages('gridExtra')
library(gridExtra)
#install.packages('grid)
library(grid)
#install.packages('ggplot2)
library(ggplot2)
#install.packages('lattice')
library(lattice)
#install.packages("tidyr")
library(tidyr)
# Load dataset ------------------------------------------------------------
getwd()
Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
View(Global_Mobility_Report)
# Start -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
# Load packages ----------------------------------------------------------
#install.packages('plotrix')
library(plotrix)
#install.packages('tibble')
library(tibble)
#install.packages('ggplot2')
library(ggplot2)
#install.packages('gridExtra')
library(gridExtra)
#install.packages('grid)
library(grid)
#install.packages('ggplot2)
library(ggplot2)
#install.packages('lattice')
library(lattice)
#install.packages("tidyr")
library(tidyr)
# Load dataset ------------------------------------------------------------
getwd()
Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
Global_Mobility_Report$date<-as.Date(Global_Mobility_Report$date,format = "%d/%m/%y")
Global_Mobility_Report$parks_percent_change_from_baseline<-as.numeric(Global_Mobility_Report$parks_percent_change_from_baseline)
UK<-subset(Global_Mobility_Report,country_region_code == "GB")
Districts_by_country<-readRDS("Districts_by_country.RDS")
getwd()
# Load dataset ------------------------------------------------------------
getwd()
Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
Global_Mobility_Report$date<-as.Date(Global_Mobility_Report$date,format = "%d/%m/%y")
Global_Mobility_Report$parks_percent_change_from_baseline<-as.numeric(Global_Mobility_Report$parks_percent_change_from_baseline)
# Subset the data to only present the UK data, separated by GB cod --------
UK<-subset(Global_Mobility_Report,country_region_code == "GB")
# Assigning country to UK districts ---------------------------------------
#saveRDS(Districts_by_country,"Districts_by_country.RDS")
Districts_by_country<-readRDS("inputdata/Districts_by_country.RDS")
# Code to assign districts to the new data set ----------------------------
#England
England_col<-UK[(UK$sub_region_1%in%Districts_by_country[[1]]),]
#plyr::count(UK$sub_region_1%in%Districts_by_country[[1]])
England_col$sub_country<-England_col$sub_country%>%replace_na("England")
#Wales
Wales_col<-UK[(UK$sub_region_1%in%Districts_by_country[[2]]),]
# Load packages ----------------------------------------------------------
#install.packages('plotrix')
library(plotrix)
#install.packages('tibble')
library(tibble)
#install.packages('ggplot2')
library(ggplot2)
#install.packages('gridExtra')
library(gridExtra)
#install.packages('grid)
library(grid)
#install.packages('ggplot2)
library(ggplot2)
#install.packages('lattice')
library(lattice)
#install.packages("tidyr")
library(tidyr)
# Load dataset ------------------------------------------------------------
getwd()
Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
Global_Mobility_Report$date<-as.Date(Global_Mobility_Report$date,format = "%d/%m/%y")
Global_Mobility_Report$parks_percent_change_from_baseline<-as.numeric(Global_Mobility_Report$parks_percent_change_from_baseline)
# Subset the data to only present the UK data, separated by GB cod --------
UK<-subset(Global_Mobility_Report,country_region_code == "GB")
# Assigning country to UK districts ---------------------------------------
#saveRDS(Districts_by_country,"Districts_by_country.RDS")
Districts_by_country<-readRDS("inputdata/Districts_by_country.RDS")
# Code to assign districts to the new data set ----------------------------
#England
England_col<-UK[(UK$sub_region_1%in%Districts_by_country[[1]]),]
#plyr::count(UK$sub_region_1%in%Districts_by_country[[1]])
England_col$sub_country<-England_col$sub_country%>%replace_na("England")
#Wales
Wales_col<-UK[(UK$sub_region_1%in%Districts_by_country[[2]]),]
Wales_col$sub_country<-Wales_col$sub_country%>%replace_na("Wales")
#Scotland
Scotland_col<-UK[(UK$sub_region_1%in%Districts_by_country[[3]]),]
Scotland_col$sub_country<-Scotland_col$sub_country%>%replace_na("Scotland")
#Northern Ireland
N_Ireland_col<-UK[(UK$sub_region_1%in%Districts_by_country[[4]]),]
N_Ireland_col$sub_country<-N_Ireland_col$sub_country%>%replace_na("N Ireland")
#Connect them all together
UK<-rbind(England_col,Wales_col,Scotland_col,N_Ireland_col)
# Subset the data to only present park data -------------------------------
Park_UK <-subset(UK,select=c(sub_region_1,sub_country,date,parks_percent_change_from_baseline))
# Calculating UK mean and SE for each country division of the UK ----------
Park_UK_mean<-tapply(Park_UK$parks_percent_change_from_baseline, list(Park_UK$sub_country,Park_UK$date),mean, na.rm=T)
Park_UK_SE<-tapply(Park_UK$parks_percent_change_from_baseline, list(Park_UK$sub_country,Park_UK$date),std.error, na.rm=T)
# Converting it into a dataframe -------------------------------------------
#Mean Values
UK_mean_df<-as.data.frame(t(Park_UK_mean))
UK_mean_df<- rownames_to_column(UK_mean_df,var="Date")
names(UK_mean_df)<-c("Date","England","N_Ireland","Scotland","Wales")
UK_mean_df$Date<-as.Date(UK_mean_df$Date)
#SE values
UK_SE_df<-as.data.frame(t(Park_UK_SE))
UK_SE_df<-rownames_to_column(UK_SE_df,var="Date")
names(UK_SE_df)<-c("Date","England","N_Ireland","Scotland","Wales")
UK_SE_df$Date<-as.Date(UK_SE_df$Date)
# Plots -------------------------------------------------------------------
#England
ENG_graph<-
ggplot(data=UK_mean_df,aes(x=Date,y=England))+
geom_line()+
geom_ribbon(aes(ymin=England-UK_SE_df$England,
ymax=England+UK_SE_df$England),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("England")+xlab("Date")+ylab("Parks percentage change from baseline")
#Wales
WAL_graph<-
ggplot(data=UK_mean_df,aes(x=Date,y=Wales))+
geom_line()+
geom_ribbon(aes(ymin=Wales-UK_SE_df$Wales,
ymax=Wales+UK_SE_df$Wales),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("Wales")+xlab("Date")+ylab("Parks percentage change from baseline")
#Scotland
SCOT_graph<-
ggplot(data=UK_mean_df,aes(x=Date,y=Scotland))+
geom_line()+
geom_ribbon(aes(ymin=Scotland-UK_SE_df$Scotland,
ymax=Scotland+UK_SE_df$Scotland),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("Scotland")+xlab("Date")+ylab("Parks percentage change from baseline")
#Northern Ireland
NI_graph<-
ggplot(data=UK_mean_df,aes(x=Date,y=N_Ireland))+
geom_line()+
geom_ribbon(aes(ymin=N_Ireland-UK_SE_df$N_Ireland,
ymax=N_Ireland+UK_SE_df$N_Ireland),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("N Ireland")+xlab("Date")+ylab("Parks percentage change from baseline")
grid.arrange(ENG_graph,WAL_graph,SCOT_graph,NI_graph, nrow = 2)
# START -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
# LOAD PACKAGES -----------------------------------------------------------
#install.packages('XML')
library(XML) # HTML processing
#install.packages('RCurl')
library(RCurl)
#install.packages('rvest')
library(rvest)
#install.packages('stringr')
library(stringr)
#DOWNLOAD New data set -----------------------------------------------------------
#Extracting the recent csv file.
base.url<-"https://www.google.com/covid19/mobility/"
base.url2<-getURL(base.url)
parsed<-htmlParse(base.url2)
doc.links<-xpathSApply(parsed,path = "//a",xmlGetAttr,"href")
csv.url<- as.character(doc.links[grep('csv', doc.links)])
Google_Mobility_data<-read.csv(csv.url, header = TRUE)
read_text<-read_html(base.url2)
text<-html_text(read_text)
read_date<-str_match(text, "Reports created\\s*(.*?)\\s*.By")
read_date
read_date<-str_match(text, "Reports created\\s*(.*?)\\s*.By")[2]
read_date
Report=paste("Global_Mobility_Report_",read_date_1,sep="")
getwd()
save(Google_Mobility_data,file = paste("/inputdata/Back up data",Report,".csv",sep=""))
save(Google_Mobility_data,file = paste("/inputdata/Back up data",Report,".csv",sep=""))
Report=paste("Global_Mobility_Report_",read_date_1,sep="")
Report=paste("Global_Mobility_Report_",read_date,sep="")
save(Google_Mobility_data,file = paste("/inputdata/Back up data",Report,".csv",sep=""))
save(Google_Mobility_data,file = paste("/inputdata/Back up data/",Report,".csv",sep=""))
write.csv(Google_Mobility_data,file = paste("/inputdata/Back up data/",Report,".csv",sep=""))
paste("/inputdata/Back up data/",Report,".csv",sep="")
write.csv(Google_Mobility_data,file = paste("inputdata/Back up data/",Report,".csv",sep=""))
write.csv(Google_Mobility_data,file = paste("inputdata/reports_backup/",Report,".csv",sep=""))
save(Google_Mobility_data,file = paste("inputdata/reports_backup/",Report,".csv",sep=""))
save(Google_Mobility_data,file = "Global_Mobility_Report.csv")
# START -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
#install.packages('XML')
library(XML) # HTML processing
#install.packages('RCurl')
library(RCurl)
#install.packages('rvest')
library(rvest)
#install.packages('stringr')
library(stringr)
#DOWNLOAD New data set -----------------------------------------------------------
#Extracting the recent csv file.
base.url<-"https://www.google.com/covid19/mobility/"
base.url2<-getURL(base.url)
parsed<-htmlParse(base.url2)
doc.links<-xpathSApply(parsed,path = "//a",xmlGetAttr,"href")
csv.url<- as.character(doc.links[grep('csv', doc.links)])
Global_Mobility_Report<-read.csv(csv.url, header = TRUE)
# Load packages ----------------------------------------------------------
#install.packages('plotrix')
library(plotrix)
#install.packages('tibble')
library(tibble)
#install.packages('ggplot2')
library(ggplot2)
#install.packages('gridExtra')
library(gridExtra)
#install.packages('grid)
library(grid)
#install.packages('ggplot2)
library(ggplot2)
#install.packages('lattice')
library(lattice)
install.packages("tidyr")
library(tidyr)
# Load dataset ------------------------------------------------------------
#getwd()
#Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report_030620.csv")
#Global_Mobility_Report$date<-as.Date(Global_Mobility_Report$date,format = "%d/%m/%y")
#Global_Mobility_Report<-read.csv("inputdata/Global_Mobility_Report.csv")
Global_Mobility_Report$date<-as.Date(Global_Mobility_Report$date)
Global_Mobility_Report$parks_percent_change_from_baseline<-as.numeric(Global_Mobility_Report$parks_percent_change_from_baseline)
#add sub_country column
Global_Mobility_Report<-Global_Mobility_Report %>% add_column(sub_country = NA, .after = which(colnames(Global_Mobility_Report)=="country_region"))
# Subset the data to only present the UK data, separated by GB cod --------
UK<-subset(Global_Mobility_Report,country_region_code == "GB")
Districts_by_country<-readRDS("inputdata/Districts_by_country.RDS")
# Code to assign districts to the new data set ----------------------------
#England
UK$sub_country[(UK$sub_region_1%in%Districts_by_country[[1]])]<-"England"
#Wales
UK$sub_country[(UK$sub_region_1%in%Districts_by_country[[2]])]<-"Wales"
#Scotland
UK$sub_country[(UK$sub_region_1%in%Districts_by_country[[3]])]<-"Scotland"
#Northern Ireland
UK$sub_country[(UK$sub_region_1%in%Districts_by_country[[4]])]<-"N_Ireland"
# Calculating UK mean and SE for each country division of the UK ----------
Park_UK_mean<-as.data.frame(t(tapply(UK$parks_percent_change_from_baseline, list(UK$sub_country,UK$date),mean, na.rm=T)))
Park_UK_mean<-rownames_to_column(Park_UK_mean,var="Date")
Park_UK_mean$Date<-as.Date(Park_UK_mean$Date)
Park_UK_SE<-as.data.frame(t(tapply(UK$parks_percent_change_from_baseline, list(UK$sub_country,UK$date),std.error, na.rm=T)))
Park_UK_SE<-rownames_to_column(Park_UK_SE,var="Date")
Park_UK_SE$Date<-as.Date(Park_UK_SE$Date)
# Plots -------------------------------------------------------------------
#England
ENG_graph<-
ggplot(data=Park_UK_mean,aes(x=Date,y=England))+
geom_line()+
geom_ribbon(aes(ymin=England-Park_UK_SE$England,
ymax=England+Park_UK_SE$England),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("England")+xlab("Date")+ylab("Parks percentage change from baseline")
#Wales
WAL_graph<-
ggplot(data=Park_UK_mean,aes(x=Date,y=Wales))+
geom_line()+
geom_ribbon(aes(ymin=Wales-Park_UK_SE$Wales,
ymax=Wales+Park_UK_SE$Wales),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("Wales")+xlab("Date")+ylab("Parks percentage change from baseline")
#Scotland
SCOT_graph<-
ggplot(data=Park_UK_mean,aes(x=Date,y=Scotland))+
geom_line()+
geom_ribbon(aes(ymin=Scotland-Park_UK_SE$Scotland,
ymax=Scotland+Park_UK_SE$Scotland),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("Scotland")+xlab("Date")+ylab("Parks percentage change from baseline")
#Northern Ireland
NI_graph<-
ggplot(data=Park_UK_mean,aes(x=Date,y=N_Ireland))+
geom_line()+
geom_ribbon(aes(ymin=N_Ireland-Park_UK_SE$N_Ireland,
ymax=N_Ireland+Park_UK_SE$N_Ireland),alpha=0.4)+
coord_cartesian(ylim=c(-60,160))+
geom_hline(yintercept=0)+
theme(panel.background = element_rect(fill = "white", colour = "black",
size = 1, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',
colour = "grey"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
colour = "grey"))+
ggtitle("N Ireland")+xlab("Date")+ylab("Parks percentage change from baseline")
grid.arrange(ENG_graph,WAL_graph,SCOT_graph,NI_graph, nrow = 2)
View(Global_Mobility_Report)
View(UK)
# START -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
#install.packages('XML')
library(XML) # HTML processing
#install.packages('RCurl')
library(RCurl)
#install.packages('rvest')
library(rvest)
#install.packages('stringr')
library(stringr)
#DOWNLOAD New data set -----------------------------------------------------------
#Extracting the recent csv file.
base.url<-"https://www.google.com/covid19/mobility/"
base.url2<-getURL(base.url)
parsed<-htmlParse(base.url2)
doc.links<-xpathSApply(parsed,path = "//a",xmlGetAttr,"href")
csv.url<- as.character(doc.links[grep('csv', doc.links)])
Google_Mobility_data<-read.csv(csv.url, header = TRUE)
# Making a code for back up -----------------------------------------------
#Extracting text from the google mobility page.
read_text<-read_html(base.url2)
text<-html_text(read_text)
#Extracting the data via inbetween strings
read_date<-str_match(text, "Reports created\\s*(.*?)\\s*\\.")[2]
#Creating the name of the file using the string function
Report=paste("Global_Mobility_Report_",read_date,sep="")
#Saving the Back up data set
save(Google_Mobility_data,file = paste("inputdata/reports_backup/",Report,".csv",sep=""))
#Saving the Current data set
save(Google_Mobility_data,file = "Global_Mobility_Report.csv")
#Saving the Current data set
save(Google_Mobility_data,file = "Global_Mobility_Report.csv")
#Saving the Current data set
save(Google_Mobility_data,file = "inputdata/Global_Mobility_Report.csv")
getwd()
q()
# START -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
#install.packages('XML')
library(XML) # HTML processing
#install.packages('RCurl')
library(RCurl)
#install.packages('rvest')
library(rvest)
#install.packages('stringr')
#library(stringr)
library(magrittr)
#Reading in each html
#NI_url<-read_html("https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland")
NI_url<-("https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland")
NI_url2<-getURL(NI_url)
old.packages()
??getURL
#Reading in each html
#NI_url<-read_html("https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland")
NI_url<-"https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland"
NI_url2<-getURL(NI_url)
#Reading in each html
#NI_url<-read_html("https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland")
NI.url<-"https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland"
NI.url2<-getURL(NI.url)
install.packages("httr")
install.packages("httr")
library(httr)
NI.url2<-GET(NI.url)
NI.doc<-readHTMLTable(doc=content(NI.url2,""))
# START -------------------------------------------------------------------
rm(list=ls())
set.seed(1234)
#install.packages('XML')
library(XML) # HTML processing
#install.packages('RCurl')
library(RCurl)
#install.packages('rvest')
library(rvest)
#install.packages("httr")
library(httr)
install.packages("htmltab")
#install.packages("htmltab")
library(htmltab)
#Reading in each html
#NI_url<-read_html("https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland")
NI.url<-htmltab("https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland")
View(NI.url)
#Reading in each html
NI.url<-"https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland"
NI.url2<-GET(NI.url)
View(NI.url2)
NI.doc<-readHTMLTable(doc = content(NI.url2,"Local Goverment Districts"))
NI.parsed<-htmlParse(NI.url2)
NI.doc<-readHTMLTable(doc = content(NI.parsed,"Local Goverment Districts"))
NI.doc<-readHTMLTable(doc = content(NI.parsed))
read_text<-read_html(NI.url2)
View(read_text)
#Reading in each html
NI.url<-"https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland"
NI<-NI.url%>%
html %>%
html_nodes("Local Goverment Districts")
??xml2
install.packages("xml2")
install.packages("xml2")
library(xml2)
NI<-read_html(NI.url)
NI.url2<-GET(NI.url)
# Checking the districts match up -----------------------------------------
NI.url<-"https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland#Local_Government_Districts"
NI.url2<-GET(NI.url)
#install.packages('XML')
library(XML) # HTML processing
#install.packages('RCurl')
library(RCurl)
#install.packages('rvest')
library(rvest)
#install.packages("httr")
library(httr)
#install.packages("htmltab")
library(htmltab)
# Checking the districts match up -----------------------------------------
NI.url<-"https://en.wikipedia.org/wiki/Local_government_in_Northern_Ireland#Local_Government_Districts"
NI.url2<-GET(NI.url)
View(NI.url2)
I
doc[1]
NI.doc[1]
NI.doc<-readHTMLTable(doc = content(NI.url2,"text"))
NI.doc[1]
NI.doc[2]
NI.df<-data.frame(NI.doc[2])
View(NI.df)
colnames(NI.df)=NI.df[1,]
View(NI.df)
NI.df<-NI.df[-1,]
View(NI.df)
# Reading in District lists -----------------------------------------------
Districts_by_country<-readRDS("Districts_by_country.RDS")
Districts_by_country<-readRDS("Districts_by_country.RDS")
??readRDS
#install.packages("readr)
library(readr)
# Reading in District lists -----------------------------------------------
Districts_by_country<-readRDS("Districts_by_country.RDS")
getwd()
